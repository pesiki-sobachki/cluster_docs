# Документация: Развертывание кластера Docker Swarm на двух серверах Ubuntu

**Цель:** Создать отказоустойчивый кластер из двух серверов (один менеджер, один воркер) для развертывания контейнеризированных приложений.

## Участники кластера:
*   **Сервер-менеджер:** `45.91.238.213`
*   **Сервер-воркер:** `45.139.77.83`

---

### Этап 1: Подготовка локальной машины (Mac) и настройка SSH-доступа

Цель этого этапа — создать безопасный способ подключения к серверам без необходимости каждый раз вводить пароль.

1.  **Создание SSH-ключа:**
    На локальной машине (Mac) была выполнена команда для генерации нового SSH-ключа типа `ed25519`.
    ```
    ssh-keygen -t ed25519 -C "stepan.chudinovskikh@gmail.com"
    ```

2.  **Добавление ключа в `ssh-agent`:**
    Ключ был добавлен в `ssh-agent` с сохранением парольной фразы в системной "Связке ключей" (Keychain).
    ```
    eval "$(ssh-agent -s)"
    ssh-add --apple-use-keychain ~/.ssh/id_ed25519
    ```

3.  **Копирование публичного ключа на серверы:**
    Публичный ключ был скопирован на оба сервера с помощью утилиты `ssh-copy-id`.
    ```
    # Для первого сервера
    ssh-copy-id root@45.91.238.213

    # Для второго сервера
    ssh-copy-id root@45.139.77.83
    ```

---

### Этап 2: Подготовка и обновление серверов

1.  **Подключение к серверам:**
    Были открыты две вкладки терминала для одновременной работы с обоими серверами.

2.  **Полное обновление системы:**
    На **каждом** из двух серверов была выполнена команда для полного обновления системы.
    ```
    apt update && apt upgrade -y && apt autoremove -y
    ```

3.  **Перезагрузка серверов:**
    Оба сервера были перезагружены для применения обновлений.
    ```
    reboot
    ```

---

### Этап 3: Создание кластера Docker Swarm

1.  **Инициализация кластера на менеджере:**
    На первом сервере (`45.91.238.213`) был инициализирован кластер.
    ```
    docker swarm init --advertise-addr 45.91.238.213
    ```

2.  **Присоединение рабочего узла (воркера):**
    На втором сервере (`45.139.77.83`) была выполнена команда, полученная на предыдущем шаге.
    ```
    docker swarm join --token <СЕКРЕТНЫЙ_ТОКЕН> 45.91.238.213:2377
    ```

3.  **Проверка состояния кластера:**
    На сервере-менеджере была выполнена команда для проверки состава кластера.
    ```
    docker node ls
    ```

---

**Результат:** Создан полнофункциональный, готовый к работе кластер Docker Swarm из двух узлов.

